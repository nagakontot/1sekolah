"use strict";void 0===THREE.OBJLoader2&&(THREE.OBJLoader2={}),THREE.OBJLoader2.WWOBJLoader2=function(){function WWOBJLoader2(){this._init()}var Validator=THREE.OBJLoader2.prototype._getValidator();return WWOBJLoader2.prototype._init=function(){if(console.log("Using THREE.OBJLoader2.WWOBJLoader2 version: 1.2.1"),void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"===(window.URL.createObjectURL,!1))throw"This browser does not support Object creation from URL!";this.instanceNo=0,this.worker=null,this.workerCode=null,this.debug=!1,this.sceneGraphBaseNode=null,this.streamMeshes=!0,this.meshStore=null,this.modelName="",this.validated=!1,this.running=!1,this.requestTerminate=!1,this.clearAllCallbacks(),this.manager=THREE.DefaultLoadingManager,this.fileLoader=new THREE.FileLoader(this.manager),this.mtlLoader=null,this.crossOrigin=null,this.dataAvailable=!1,this.objAsArrayBuffer=null,this.fileObj=null,this.pathObj=null,this.fileMtl=null,this.mtlAsString=null,this.texturePath=null,this.materials=[],this.counter=0},WWOBJLoader2.prototype.setDebug=function(enabled){this.debug=enabled},WWOBJLoader2.prototype.setCrossOrigin=function(crossOrigin){this.crossOrigin=crossOrigin},WWOBJLoader2.prototype.registerCallbackProgress=function(callbackProgress){Validator.isValid(callbackProgress)&&this.callbacks.progress.push(callbackProgress)},WWOBJLoader2.prototype.registerCallbackCompletedLoading=function(callbackCompletedLoading){Validator.isValid(callbackCompletedLoading)&&this.callbacks.completedLoading.push(callbackCompletedLoading)},WWOBJLoader2.prototype.registerCallbackMaterialsLoaded=function(callbackMaterialsLoaded){Validator.isValid(callbackMaterialsLoaded)&&this.callbacks.materialsLoaded.push(callbackMaterialsLoaded)},WWOBJLoader2.prototype.registerCallbackMeshLoaded=function(callbackMeshLoaded){Validator.isValid(callbackMeshLoaded)&&this.callbacks.meshLoaded.push(callbackMeshLoaded)},WWOBJLoader2.prototype.registerCallbackErrorWhileLoading=function(callbackErrorWhileLoading){Validator.isValid(callbackErrorWhileLoading)&&this.callbacks.errorWhileLoading.push(callbackErrorWhileLoading)},WWOBJLoader2.prototype.clearAllCallbacks=function(){this.callbacks={progress:[],completedLoading:[],errorWhileLoading:[],materialsLoaded:[],meshLoaded:[]}},WWOBJLoader2.prototype.setRequestTerminate=function(requestTerminate){this.requestTerminate=!0===requestTerminate},WWOBJLoader2.prototype._validate=function(){if(!this.validated){if(!Validator.isValid(this.worker)){this._buildWebWorkerCode();var blob=new Blob([this.workerCode],{type:"text/plain"});this.worker=new Worker(window.URL.createObjectURL(blob));var scope=this,scopeFunction=function(e){scope._receiveWorkerMessage(e)};this.worker.addEventListener("message",scopeFunction,!1)}this.sceneGraphBaseNode=null,this.streamMeshes=!0,this.meshStore=[],this.modelName="",this.validated=!0,this.running=!0,this.requestTerminate=!1,this.fileLoader=Validator.verifyInput(this.fileLoader,new THREE.FileLoader(this.manager)),this.mtlLoader=Validator.verifyInput(this.mtlLoader,new THREE.MTLLoader),Validator.isValid(this.crossOrigin)&&this.mtlLoader.setCrossOrigin(this.crossOrigin),this.dataAvailable=!1,this.fileObj=null,this.pathObj=null,this.fileMtl=null,this.texturePath=null,this.objAsArrayBuffer=null,this.mtlAsString=null,this.materials=[];var defaultMaterial=new THREE.MeshStandardMaterial({color:14479871});defaultMaterial.name="defaultMaterial",this.materials[defaultMaterial.name]=defaultMaterial,this.counter=0}},WWOBJLoader2.prototype.prepareRun=function(params){if(this._validate(),this.dataAvailable=params.dataAvailable,this.modelName=params.modelName,console.time("WWOBJLoader2"),this.dataAvailable){if(!(params.objAsArrayBuffer instanceof Uint8Array))throw"Provided input is not of type arraybuffer! Aborting...";this.worker.postMessage({cmd:"init",debug:this.debug}),this.objAsArrayBuffer=params.objAsArrayBuffer,this.mtlAsString=params.mtlAsString}else{if(!("string"==typeof params.fileObj||params.fileObj instanceof String))throw"Provided file is not properly defined! Aborting...";this.worker.postMessage({cmd:"init",debug:this.debug}),this.fileObj=params.fileObj,this.pathObj=params.pathObj,this.fileMtl=params.fileMtl}this.setRequestTerminate(params.requestTerminate),this.pathTexture=params.pathTexture,this.sceneGraphBaseNode=params.sceneGraphBaseNode,this.streamMeshes=params.streamMeshes,this.streamMeshes||(this.meshStore=[])},WWOBJLoader2.prototype.run=function(){var scope=this,processLoadedMaterials=function(materialCreator){var materialCreatorMaterials=[],materialNames=[];if(Validator.isValid(materialCreator)){materialCreator.preload(),materialCreatorMaterials=materialCreator.materials;for(var materialName in materialCreatorMaterials)materialCreatorMaterials.hasOwnProperty(materialName)&&(materialNames.push(materialName),scope.materials[materialName]=materialCreatorMaterials[materialName])}scope.worker.postMessage({cmd:"setMaterials",materialNames:materialNames});var materialsFromCallback,callbackMaterialsLoaded;for(var index in scope.callbacks.materialsLoaded)callbackMaterialsLoaded=scope.callbacks.materialsLoaded[index],materialsFromCallback=callbackMaterialsLoaded(scope.materials),Validator.isValid(materialsFromCallback)&&(scope.materials=materialsFromCallback);if(scope.dataAvailable&&scope.objAsArrayBuffer)scope.worker.postMessage({cmd:"run",objAsArrayBuffer:scope.objAsArrayBuffer},[scope.objAsArrayBuffer.buffer]);else{var output,refPercentComplete=0,percentComplete=0,onLoad=function(objAsArrayBuffer){scope._announceProgress("Running web worker!"),scope.objAsArrayBuffer=new Uint8Array(objAsArrayBuffer),scope.worker.postMessage({cmd:"run",objAsArrayBuffer:scope.objAsArrayBuffer},[scope.objAsArrayBuffer.buffer])},onProgress=function(event){event.lengthComputable&&(percentComplete=Math.round(event.loaded/event.total*100))>refPercentComplete&&(refPercentComplete=percentComplete,output='Download of "'+scope.fileObj+'": '+percentComplete+"%",console.log(output),scope._announceProgress(output))},onError=function(event){output='Error occurred while downloading "'+scope.fileObj+'"',console.error(output+": "+event),scope._announceProgress(output),scope._finalize("error")};scope.fileLoader.setPath(scope.pathObj),scope.fileLoader.setResponseType("arraybuffer"),scope.fileLoader.load(scope.fileObj,onLoad,onProgress,onError)}console.timeEnd("Loading MTL textures")};if(this.mtlLoader.setPath(this.pathTexture),this.dataAvailable)processLoadedMaterials(Validator.isValid(this.mtlAsString)?this.mtlLoader.parse(this.mtlAsString):null);else if(Validator.isValid(this.fileMtl)){var onError=function(event){output='Error occurred while downloading "'+scope.fileMtl+'"',console.error(output+": "+event),scope._announceProgress(output),scope._finalize("error")};this.mtlLoader.load(this.fileMtl,processLoadedMaterials,void 0,onError)}else processLoadedMaterials()},WWOBJLoader2.prototype._receiveWorkerMessage=function(event){var payload=event.data;switch(payload.cmd){case"objData":this.counter++;var meshName=payload.meshName,bufferGeometry=new THREE.BufferGeometry;bufferGeometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(payload.vertices),3)),Validator.isValid(payload.normals)?bufferGeometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(payload.normals),3)):bufferGeometry.computeVertexNormals(),Validator.isValid(payload.uvs)&&bufferGeometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(payload.uvs),2));var materialDescription,material,materialName,key,materialDescriptions=payload.materialDescriptions,createMultiMaterial=payload.multiMaterial,multiMaterials=[];for(key in materialDescriptions){if(materialDescription=materialDescriptions[key],material=this.materials[materialDescription.name],materialDescription.default)material=this.materials.defaultMaterial;else if(materialDescription.clone){materialName=material.name+"_flat";var materialClone=this.materials[materialName];materialClone||(materialClone=material.clone(),materialClone.name=materialName,materialClone.shading=THREE.FlatShading,this.materials[materialName]=name)}else material||(material=this.materials.defaultMaterial);createMultiMaterial&&multiMaterials.push(material)}if(createMultiMaterial){material=multiMaterials;var materialGroup,materialGroups=payload.materialGroups;for(key in materialGroups)materialGroup=materialGroups[key],bufferGeometry.addGroup(materialGroup.start,materialGroup.count,materialGroup.index)}var callbackMeshLoaded,callbackMeshLoadedResult,disregardMesh=!1;for(var index in this.callbacks.meshLoaded)if(callbackMeshLoaded=this.callbacks.meshLoaded[index],callbackMeshLoadedResult=callbackMeshLoaded(meshName,bufferGeometry,material),Validator.isValid(callbackMeshLoadedResult)){if(callbackMeshLoadedResult.disregardMesh){disregardMesh=!0;break}callbackMeshLoadedResult.replaceBufferGeometry&&(bufferGeometry=callbackMeshLoadedResult.bufferGeometry),callbackMeshLoadedResult.replaceMaterial&&(material=callbackMeshLoadedResult.material)}if(disregardMesh)this._announceProgress("Removing mesh:",meshName);else{var mesh=new THREE.Mesh(bufferGeometry,material);mesh.name=meshName,this.streamMeshes?this.sceneGraphBaseNode.add(mesh):this.meshStore.push(mesh),this._announceProgress("Adding mesh ("+this.counter+"):",meshName)}break;case"complete":if(!this.streamMeshes)for(var meshStoreKey in this.meshStore)this.meshStore.hasOwnProperty(meshStoreKey)&&this.sceneGraphBaseNode.add(this.meshStore[meshStoreKey]);console.timeEnd("WWOBJLoader2"),Validator.isValid(payload.msg)?this._announceProgress(payload.msg):this._announceProgress(""),this._finalize("complete");break;case"report_progress":this._announceProgress("",payload.output);break;default:console.error("Received unknown command: "+payload.cmd)}},WWOBJLoader2.prototype._terminate=function(){if(Validator.isValid(this.worker)){if(this.running)throw"Unable to gracefully terminate worker as it is currently running!";this.worker.terminate(),this.worker=null,this.workerCode=null,this._finalize("terminate")}this.fileLoader=null,this.mtlLoader=null},WWOBJLoader2.prototype._finalize=function(reason,requestTerminate){this.running=!1;var index;if("complete"===reason)for(index in this.callbacks.completedLoading)(0,this.callbacks.completedLoading[index])(this.modelName,this.instanceNo,this.requestTerminate);else if("error"===reason)for(index in this.callbacks.errorWhileLoading)(0,this.callbacks.errorWhileLoading[index])(this.modelName,this.instanceNo,this.requestTerminate);this.validated=!1,this.setRequestTerminate(requestTerminate),this.requestTerminate&&this._terminate()},WWOBJLoader2.prototype._announceProgress=function(baseText,text){var output=Validator.isValid(baseText)?baseText:"";output=Validator.isValid(text)?output+" "+text:output;for(var index in this.callbacks.progress)(0,this.callbacks.progress[index])(output);this.debug&&console.log(output)},WWOBJLoader2.prototype._buildWebWorkerCode=function(existingWorkerCode){if(Validator.isValid(existingWorkerCode)&&(this.workerCode=existingWorkerCode),!Validator.isValid(this.workerCode)){console.time("buildWebWorkerCode");var wwDef=function(){function WWOBJLoader(){this.wwMeshCreator=new WWMeshCreator,this.parser=new Parser(this.wwMeshCreator),this.validated=!1,this.cmdState="created",this.debug=!1}return WWOBJLoader.prototype.setDebug=function(parserDebug,meshCreatorDebug){this.parser.setDebug(parserDebug),this.wwMeshCreator.setDebug(meshCreatorDebug)},WWOBJLoader.prototype.parse=function(arrayBuffer){console.log("Parsing arrayBuffer..."),console.time("parseArrayBuffer"),this.validate(),this.parser.parseArrayBuffer(arrayBuffer);var objGroup=this._finalize();return console.timeEnd("parseArrayBuffer"),objGroup},WWOBJLoader.prototype.validate=function(){this.validated||(this.parser.validate(),this.wwMeshCreator.validate(),this.validated=!0)},WWOBJLoader.prototype._finalize=function(){console.log("Global output object count: "+this.wwMeshCreator.globalObjectCount),this.parser.finalize(),this.wwMeshCreator.finalize(),this.validated=!1},WWOBJLoader.prototype.init=function(payload){this.cmdState="init",this.setDebug(payload.debug,payload.debug)},WWOBJLoader.prototype.setMaterials=function(payload){this.cmdState="setMaterials",this.wwMeshCreator.setMaterials(payload.materialNames)},WWOBJLoader.prototype.run=function(payload){this.cmdState="run",this.parse(payload.objAsArrayBuffer),console.log("OBJ loading complete!"),this.cmdState="complete",self.postMessage({cmd:this.cmdState,msg:null})},WWOBJLoader}(),wwMeshCreatorDef=function(){function WWMeshCreator(){this.materials=null,this.debug=!1,this.globalObjectCount=1,this.validated=!1}return WWMeshCreator.prototype.setMaterials=function(materials){this.materials=Validator.verifyInput(materials,this.materials),this.materials=Validator.verifyInput(this.materials,{materials:[]})},WWMeshCreator.prototype.setDebug=function(debug){!0!==debug&&!1!==debug||(this.debug=debug)},WWMeshCreator.prototype.validate=function(){this.validated||(this.setMaterials(null),this.setDebug(null),this.globalObjectCount=1)},WWMeshCreator.prototype.finalize=function(){this.materials=null,this.validated=!1},WWMeshCreator.prototype.buildMesh=function(rawObjectDescriptions,inputObjectCount,absoluteVertexCount,absoluteNormalCount,absoluteUvCount){this.debug&&console.log("OBJLoader.buildMesh:\nInput object no.: "+inputObjectCount);var rawObjectDescription,materialDescription,selectedMaterialIndex,materialGroup,vertexLength,vertexFa=new Float32Array(absoluteVertexCount),normalFA=absoluteNormalCount>0?new Float32Array(absoluteNormalCount):null,uvFA=absoluteUvCount>0?new Float32Array(absoluteUvCount):null,materialDescriptions=[],createMultiMaterial=rawObjectDescriptions.length>1,materialIndex=0,materialIndexMapping=[],materialGroups=[],vertexBAOffset=0,vertexGroupOffset=0,normalOffset=0,uvOffset=0;for(var oodIndex in rawObjectDescriptions)rawObjectDescriptions.hasOwnProperty(oodIndex)&&(rawObjectDescription=rawObjectDescriptions[oodIndex],materialDescription={name:rawObjectDescription.materialName,flat:!1,default:!1},null===this.materials[materialDescription.name]&&(materialDescription.default=!0,console.warn('object_group "'+rawObjectDescription.objectName+"_"+rawObjectDescription.groupName+'" was defined without material! Assigning "defaultMaterial".')),0===rawObjectDescription.smoothingGroup&&(materialDescription.flat=!0),vertexLength=rawObjectDescription.vertices.length,createMultiMaterial?(selectedMaterialIndex=materialIndexMapping[materialDescription.name],selectedMaterialIndex||(selectedMaterialIndex=materialIndex,materialIndexMapping[materialDescription.name]=materialIndex,materialDescriptions.push(materialDescription),materialIndex++),materialGroup={start:vertexGroupOffset,count:vertexLength/3,index:selectedMaterialIndex},materialGroups.push(materialGroup),vertexGroupOffset+=vertexLength/3):materialDescriptions.push(materialDescription),vertexFa.set(rawObjectDescription.vertices,vertexBAOffset),vertexBAOffset+=vertexLength,normalFA&&(normalFA.set(rawObjectDescription.normals,normalOffset),normalOffset+=rawObjectDescription.normals.length),uvFA&&(uvFA.set(rawObjectDescription.uvs,uvOffset),uvOffset+=rawObjectDescription.uvs.length),this.debug&&this.printReport(rawObjectDescription,selectedMaterialIndex));self.postMessage({cmd:"objData",meshName:""!==rawObjectDescription.groupName?rawObjectDescription.groupName:rawObjectDescription.objectName,multiMaterial:createMultiMaterial,materialDescriptions:materialDescriptions,materialGroups:materialGroups,vertices:vertexFa,normals:normalFA,uvs:uvFA},[vertexFa.buffer],null!==normalFA?[normalFA.buffer]:null,null!==uvFA?[uvFA.buffer]:null),this.globalObjectCount++},WWMeshCreator}(),wwObjLoaderRunnerDef=function(){function WWOBJLoaderRunner(){self.addEventListener("message",this.runner,!1)}return WWOBJLoaderRunner.prototype.runner=function(event){var payload=event.data;switch(console.log("Command state before: "+WWOBJLoaderRef.cmdState),payload.cmd){case"init":WWOBJLoaderRef.init(payload);break;case"setMaterials":WWOBJLoaderRef.setMaterials(payload);break;case"run":WWOBJLoaderRef.run(payload);break;default:console.error("OBJLoader: Received unknown command: "+payload.cmd)}console.log("Command state after: "+WWOBJLoaderRef.cmdState)},WWOBJLoaderRunner}(),buildObject=function(fullName,object){var part,objectString=fullName+" = {\n";for(var name in object)part=object[name],"string"==typeof part||part instanceof String?(part=part.replace("\n","\\n"),part=part.replace("\r","\\r"),objectString+="\t"+name+': "'+part+'",\n'):part instanceof Array?objectString+="\t"+name+": ["+part+"],\n":Number.isInteger(part)?objectString+="\t"+name+": "+part+",\n":"function"==typeof part&&(objectString+="\t"+name+": "+part+",\n");return objectString+="}\n\n"},buildSingelton=function(fullName,internalName,object){var objectString=fullName+" = (function () {\n\n";objectString+="\t"+object.prototype.constructor.toString()+"\n\n";var funcString,objectPart;for(var name in object.prototype)"function"==typeof(objectPart=object.prototype[name])&&(funcString=objectPart.toString(),objectString+="\t"+internalName+".prototype."+name+" = "+funcString+";\n\n");return objectString+="\treturn "+internalName+";\n",objectString+="})();\n\n"};this.workerCode="",this.workerCode+="/**\n",this.workerCode+="  * This code was constructed by WWOBJLoader2._buildWebWorkerCode\n",this.workerCode+="  */\n\n",this.workerCode+=THREE.OBJLoader2.prototype._buildWebWorkerCode(buildObject,buildSingelton),this.workerCode+=buildSingelton("WWOBJLoader","WWOBJLoader",wwDef),this.workerCode+=buildSingelton("WWMeshCreator","WWMeshCreator",wwMeshCreatorDef),this.workerCode+="WWOBJLoaderRef = new WWOBJLoader();\n\n",this.workerCode+=buildSingelton("WWOBJLoaderRunner","WWOBJLoaderRunner",wwObjLoaderRunnerDef),this.workerCode+="new WWOBJLoaderRunner();\n\n",console.timeEnd("buildWebWorkerCode")}return this.workerCode},WWOBJLoader2}(),THREE.OBJLoader2.WWOBJLoader2.PrepDataArrayBuffer=function(modelName,objAsArrayBuffer,pathTexture,mtlAsString){var Validator=THREE.OBJLoader2.prototype._getValidator();return{setSceneGraphBaseNode:function(sceneGraphBaseNode){this.sceneGraphBaseNode=Validator.verifyInput(sceneGraphBaseNode,null)},setStreamMeshes:function(streamMeshes){this.streamMeshes=!1!==streamMeshes},setRequestTerminate:function(requestTerminate){this.requestTerminate=!0===requestTerminate},getCallbacks:function(){return this.callbacks},modelName:Validator.verifyInput(modelName,""),dataAvailable:!0,objAsArrayBuffer:Validator.verifyInput(objAsArrayBuffer,null),pathTexture:Validator.verifyInput(pathTexture,null),mtlAsString:Validator.verifyInput(mtlAsString,null),sceneGraphBaseNode:null,streamMeshes:!0,requestTerminate:!1,callbacks:new THREE.OBJLoader2.WWOBJLoader2.PrepDataCallbacks}},THREE.OBJLoader2.WWOBJLoader2.PrepDataFile=function(modelName,pathObj,fileObj,pathTexture,fileMtl){var Validator=THREE.OBJLoader2.prototype._getValidator();return{setSceneGraphBaseNode:function(sceneGraphBaseNode){this.sceneGraphBaseNode=Validator.verifyInput(sceneGraphBaseNode,null)},setStreamMeshes:function(streamMeshes){this.streamMeshes=!1!==streamMeshes},setRequestTerminate:function(requestTerminate){this.requestTerminate=!0===requestTerminate},getCallbacks:function(){return this.callbacks},modelName:Validator.verifyInput(modelName,""),dataAvailable:!1,pathObj:Validator.verifyInput(pathObj,null),fileObj:Validator.verifyInput(fileObj,null),pathTexture:Validator.verifyInput(pathTexture,null),fileMtl:Validator.verifyInput(fileMtl,null),sceneGraphBaseNode:null,streamMeshes:!0,requestTerminate:!1,callbacks:new THREE.OBJLoader2.WWOBJLoader2.PrepDataCallbacks}},THREE.OBJLoader2.WWOBJLoader2.PrepDataCallbacks=function(){var Validator=THREE.OBJLoader2.prototype._getValidator();return{registerCallbackProgress:function(callbackProgress){Validator.isValid(callbackProgress)&&(this.progress=callbackProgress)},registerCallbackCompletedLoading:function(callbackCompletedLoading){Validator.isValid(callbackCompletedLoading)&&(this.completedLoading=callbackCompletedLoading)},registerCallbackMaterialsLoaded:function(callbackMaterialsLoaded){Validator.isValid(callbackMaterialsLoaded)&&(this.materialsLoaded=callbackMaterialsLoaded)},registerCallbackMeshLoaded:function(callbackMeshLoaded){Validator.isValid(callbackMeshLoaded)&&(this.meshLoaded=callbackMeshLoaded)},registerCallbackErrorWhileLoading:function(callbackErrorWhileLoading){Validator.isValid(callbackErrorWhileLoading)&&(this.errorWhileLoading=callbackErrorWhileLoading)},progress:null,completedLoading:null,errorWhileLoading:null,materialsLoaded:null,meshLoaded:null}},THREE.OBJLoader2.WWOBJLoader2.LoadedMeshUserOverride=function(disregardMesh,bufferGeometry,material){var Validator=THREE.OBJLoader2.prototype._getValidator();return{disregardMesh:!0===disregardMesh,replaceBufferGeometry:Validator.isValid(bufferGeometry),bufferGeometry:Validator.verifyInput(bufferGeometry,null),replaceMaterial:Validator.isValid(material),material:Validator.verifyInput(material,null)}},THREE.OBJLoader2.WWOBJLoader2Director=function(){function WWOBJLoader2Director(){this.maxQueueSize=MAX_QUEUE_SIZE,this.maxWebWorkers=MAX_WEB_WORKER,this.crossOrigin=null,this.workerDescription={prototypeDef:THREE.OBJLoader2.WWOBJLoader2.prototype,globalCallbacks:{},webWorkers:[],codeBuffer:null},this.objectsCompleted=0,this.instructionQueue=[]}var Validator=THREE.OBJLoader2.prototype._getValidator(),MAX_WEB_WORKER=16,MAX_QUEUE_SIZE=1024;return WWOBJLoader2Director.prototype.getMaxQueueSize=function(){return this.maxQueueSize},WWOBJLoader2Director.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},WWOBJLoader2Director.prototype.setCrossOrigin=function(crossOrigin){this.crossOrigin=crossOrigin},WWOBJLoader2Director.prototype.prepareWorkers=function(globalCallbacks,maxQueueSize,maxWebWorkers){Validator.isValid(globalCallbacks)&&(this.workerDescription.globalCallbacks=globalCallbacks),this.maxQueueSize=Math.min(maxQueueSize,MAX_QUEUE_SIZE),this.maxWebWorkers=Math.min(maxWebWorkers,MAX_WEB_WORKER),this.objectsCompleted=0,this.instructionQueue=[];var start=this.workerDescription.webWorkers.length;if(start<this.maxWebWorkers)for(i=start;i<this.maxWebWorkers;i++)webWorker=this._buildWebWorker(),this.workerDescription.webWorkers[i]=webWorker;else for(var webWorker,i=start-1;i>=this.maxWebWorkers;i--)webWorker=this.workerDescription.webWorkers[i],webWorker.setRequestTerminate(!0),this.workerDescription.webWorkers.pop()},WWOBJLoader2Director.prototype.enqueueForRun=function(runParams){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(runParams)},WWOBJLoader2Director.prototype.processQueue=function(){if(0!==this.instructionQueue.length)for(var length=Math.min(this.maxWebWorkers,this.instructionQueue.length),i=0;i<length;i++)this._kickWebWorkerRun(this.workerDescription.webWorkers[i],this.instructionQueue[0]),this.instructionQueue.shift()},WWOBJLoader2Director.prototype._kickWebWorkerRun=function(worker,runParams){worker.clearAllCallbacks();var key,selectedGlobalCallback,globalCallbacks=this.workerDescription.globalCallbacks,workerCallbacks=worker.callbacks;for(key in globalCallbacks)workerCallbacks.hasOwnProperty(key)&&globalCallbacks.hasOwnProperty(key)&&(selectedGlobalCallback=globalCallbacks[key],Validator.isValid(selectedGlobalCallback)&&workerCallbacks[key].push(selectedGlobalCallback));var runCallbacks=runParams.callbacks;if(Validator.isValid(runCallbacks))for(key in runCallbacks)workerCallbacks.hasOwnProperty(key)&&runCallbacks.hasOwnProperty(key)&&Validator.isValid(runCallbacks[key])&&workerCallbacks[key].push(runCallbacks[key]);var scope=this,directorCompletedLoading=function(modelName,instanceNo,requestTerminate){if(scope.objectsCompleted++,!requestTerminate){var worker=scope.workerDescription.webWorkers[instanceNo],runParams=scope.instructionQueue[0];Validator.isValid(runParams)&&(console.log("\nAssigning next item from queue to worker (queue length: "+scope.instructionQueue.length+")\n\n"),scope._kickWebWorkerRun(worker,runParams),scope.instructionQueue.shift())}};worker.registerCallbackCompletedLoading(directorCompletedLoading),worker.prepareRun(runParams),worker.run()},WWOBJLoader2Director.prototype._buildWebWorker=function(){var webWorker=Object.create(this.workerDescription.prototypeDef);return webWorker._init(),Validator.isValid(this.crossOrigin)&&webWorker.setCrossOrigin(this.crossOrigin),Validator.isValid(this.workerDescription.codeBuffer)?webWorker._buildWebWorkerCode(this.workerDescription.codeBuffer):this.workerDescription.codeBuffer=webWorker._buildWebWorkerCode(),webWorker.instanceNo=this.workerDescription.webWorkers.length,this.workerDescription.webWorkers.push(webWorker),webWorker},WWOBJLoader2Director.prototype.deregister=function(){console.log("WWOBJLoader2Director received the unregister call. Terminating all workers!");for(var webWorker,i=0,length=this.workerDescription.webWorkers.length;i<length;i++)webWorker=this.workerDescription.webWorkers[i],webWorker.setRequestTerminate(!0);this.workerDescription.globalCallbacks={},this.workerDescription.webWorkers=[],this.workerDescription.codeBuffer=null},WWOBJLoader2Director}();