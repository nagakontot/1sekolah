"use strict";void 0===THREE.OBJLoader2&&(THREE.OBJLoader2={}),THREE.OBJLoader2=function(){function OBJLoader2(manager){console.log("Using THREE.OBJLoader2 version: "+OBJLOADER2_VERSION),this.manager=Validator.verifyInput(manager,THREE.DefaultLoadingManager),this.path="",this.fileLoader=new THREE.FileLoader(this.manager),this.meshCreator=new MeshCreator,this.parser=new Parser(this.meshCreator),this.validated=!1}var OBJLOADER2_VERSION="1.2.1";OBJLoader2.prototype.setPath=function(path){this.path=Validator.verifyInput(path,this.path)},OBJLoader2.prototype.setSceneGraphBaseNode=function(sceneGraphBaseNode){this.meshCreator.setSceneGraphBaseNode(sceneGraphBaseNode)},OBJLoader2.prototype.setMaterials=function(materials){this.meshCreator.setMaterials(materials)},OBJLoader2.prototype.setDebug=function(parserDebug,meshCreatorDebug){this.parser.setDebug(parserDebug),this.meshCreator.setDebug(meshCreatorDebug)},OBJLoader2.prototype.load=function(url,onLoad,onProgress,onError,useArrayBuffer){this._validate(),this.fileLoader.setPath(this.path),this.fileLoader.setResponseType(!1!==useArrayBuffer?"arraybuffer":"text");var scope=this;scope.fileLoader.load(url,function(content){onLoad(!1!==useArrayBuffer?scope.parse(content):scope.parseText(content))},onProgress,onError)},OBJLoader2.prototype.parse=function(arrayBuffer){if(!(arrayBuffer instanceof ArrayBuffer||arrayBuffer instanceof Uint8Array))throw"Provided input is not of type arraybuffer! Aborting...";console.log("Parsing arrayBuffer..."),console.time("parseArrayBuffer"),this._validate(),this.parser.parseArrayBuffer(arrayBuffer);var sceneGraphAttach=this._finalize();return console.timeEnd("parseArrayBuffer"),sceneGraphAttach},OBJLoader2.prototype.parseText=function(text){if(!("string"==typeof text||text instanceof String))throw"Provided input is not of type String! Aborting...";console.log("Parsing text..."),console.time("parseText"),this._validate(),this.parser.parseText(text);var sceneGraphBaseNode=this._finalize();return console.timeEnd("parseText"),sceneGraphBaseNode},OBJLoader2.prototype._validate=function(){this.validated||(this.fileLoader=Validator.verifyInput(this.fileLoader,new THREE.FileLoader(this.manager)),this.parser.validate(),this.meshCreator.validate(),this.validated=!0)},OBJLoader2.prototype._finalize=function(){console.log("Global output object count: "+this.meshCreator.globalObjectCount),this.parser.finalize(),this.fileLoader=null;var sceneGraphBaseNode=this.meshCreator.sceneGraphBaseNode;return this.meshCreator.finalize(),this.validated=!1,sceneGraphBaseNode};var Consts={CODE_LF:10,CODE_CR:13,CODE_SPACE:32,CODE_SLASH:47,STRING_LF:"\n",STRING_CR:"\r",STRING_SPACE:" ",STRING_SLASH:"/",LINE_F:"f",LINE_G:"g",LINE_L:"l",LINE_O:"o",LINE_S:"s",LINE_V:"v",LINE_VT:"vt",LINE_VN:"vn",LINE_MTLLIB:"mtllib",LINE_USEMTL:"usemtl",QUAD_INDICES_1:[1,2,3,3,4,1],QUAD_INDICES_2:[1,3,5,5,7,1],QUAD_INDICES_3:[1,4,7,7,10,1]},Validator={isValid:function(input){return null!==input&&void 0!==input},verifyInput:function(input,defaultValue){return null===input||void 0===input?defaultValue:input}};OBJLoader2.prototype._getValidator=function(){return Validator};var Parser=function(){function Parser(meshCreator){this.meshCreator=meshCreator,this.rawObject=null,this.inputObjectCount=1,this.debug=!1}return Parser.prototype.setDebug=function(debug){!0!==debug&&!1!==debug||(this.debug=debug)},Parser.prototype.validate=function(){this.rawObject=new RawObject,this.inputObjectCount=1},Parser.prototype.parseArrayBuffer=function(arrayBuffer){for(var code,arrayBufferView=new Uint8Array(arrayBuffer),length=arrayBufferView.byteLength,buffer=new Array(32),bufferPointer=0,slashes=new Array(32),slashesPointer=0,reachedFaces=!1,word="",i=0;i<length;i++)switch(code=arrayBufferView[i]){case Consts.CODE_SPACE:word.length>0&&(buffer[bufferPointer++]=word),word="";break;case Consts.CODE_SLASH:slashes[slashesPointer++]=i,word.length>0&&(buffer[bufferPointer++]=word),word="";break;case Consts.CODE_LF:word.length>0&&(buffer[bufferPointer++]=word),word="",reachedFaces=this.processLine(buffer,bufferPointer,slashes,slashesPointer,reachedFaces),slashesPointer=0,bufferPointer=0;break;case Consts.CODE_CR:break;default:word+=String.fromCharCode(code)}},Parser.prototype.parseText=function(text){for(var char,length=text.length,buffer=new Array(32),bufferPointer=0,slashes=new Array(32),slashesPointer=0,reachedFaces=!1,word="",i=0;i<length;i++)switch(char=text[i]){case Consts.STRING_SPACE:word.length>0&&(buffer[bufferPointer++]=word),word="";break;case Consts.STRING_SLASH:slashes[slashesPointer++]=i,word.length>0&&(buffer[bufferPointer++]=word),word="";break;case Consts.STRING_LF:word.length>0&&(buffer[bufferPointer++]=word),word="",reachedFaces=this.processLine(buffer,bufferPointer,slashes,slashesPointer,reachedFaces),slashesPointer=0,bufferPointer=0;break;case Consts.STRING_CR:break;default:word+=char}},Parser.prototype.processLine=function(buffer,bufferPointer,slashes,slashesPointer,reachedFaces){if(bufferPointer<1)return reachedFaces;var concatBuffer,bufferLength=bufferPointer-1;switch(buffer[0]){case Consts.LINE_V:reachedFaces&&(this.processCompletedObject(null,this.rawObject.groupName),reachedFaces=!1),this.rawObject.pushVertex(buffer);break;case Consts.LINE_VT:this.rawObject.pushUv(buffer);break;case Consts.LINE_VN:this.rawObject.pushNormal(buffer);break;case Consts.LINE_F:reachedFaces=!0;var haveQuad=bufferLength%4==0;slashesPointer>1&&slashes[1]-slashes[0]==1?haveQuad?this.rawObject.buildQuadVVn(buffer):this.rawObject.buildFaceVVn(buffer):bufferLength===2*slashesPointer?haveQuad?this.rawObject.buildQuadVVt(buffer):this.rawObject.buildFaceVVt(buffer):2*bufferLength==3*slashesPointer?haveQuad?this.rawObject.buildQuadVVtVn(buffer):this.rawObject.buildFaceVVtVn(buffer):haveQuad?this.rawObject.buildQuadV(buffer):this.rawObject.buildFaceV(buffer);break;case Consts.LINE_L:bufferLength===2*slashesPointer?this.rawObject.buildLineVvt(buffer):this.rawObject.buildLineV(buffer);break;case Consts.LINE_S:this.rawObject.pushSmoothingGroup(buffer[1]);break;case Consts.LINE_G:concatBuffer=bufferLength>1?buffer.slice(1,bufferPointer).join(" "):buffer[1],this.processCompletedGroup(concatBuffer);break;case Consts.LINE_O:concatBuffer=bufferLength>1?buffer.slice(1,bufferPointer).join(" "):buffer[1],this.rawObject.vertices.length>0?(this.processCompletedObject(concatBuffer,null),reachedFaces=!1):this.rawObject.pushObject(concatBuffer);break;case Consts.LINE_MTLLIB:concatBuffer=bufferLength>1?buffer.slice(1,bufferPointer).join(" "):buffer[1],this.rawObject.pushMtllib(concatBuffer);break;case Consts.LINE_USEMTL:concatBuffer=bufferLength>1?buffer.slice(1,bufferPointer).join(" "):buffer[1],this.rawObject.pushUsemtl(concatBuffer)}return reachedFaces},Parser.prototype.processCompletedObject=function(objectName,groupName){this.rawObject.finalize(this.meshCreator,this.inputObjectCount,this.debug),this.inputObjectCount++,this.rawObject=this.rawObject.newInstanceFromObject(objectName,groupName)},Parser.prototype.processCompletedGroup=function(groupName){this.rawObject.finalize(this.meshCreator,this.inputObjectCount,this.debug)?(this.inputObjectCount++,this.rawObject=this.rawObject.newInstanceFromGroup(groupName)):this.rawObject.pushGroup(groupName)},Parser.prototype.finalize=function(){this.rawObject.finalize(this.meshCreator,this.inputObjectCount,this.debug),this.inputObjectCount++},Parser}(),RawObject=function(){function RawObject(objectName,groupName,mtllibName){this.globalVertexOffset=1,this.globalUvOffset=1,this.globalNormalOffset=1,this.vertices=[],this.normals=[],this.uvs=[],this.mtllibName=Validator.verifyInput(mtllibName,""),this.objectName=Validator.verifyInput(objectName,""),this.groupName=Validator.verifyInput(groupName,""),this.activeMtlName="",this.activeSmoothingGroup=1,this.mtlCount=0,this.smoothingGroupCount=0,this.rawObjectDescriptions=[];var index=this.buildIndex(this.activeMtlName,this.activeSmoothingGroup);this.rawObjectDescriptionInUse=new RawObjectDescription(this.objectName,this.groupName,this.activeMtlName,this.activeSmoothingGroup),this.rawObjectDescriptions[index]=this.rawObjectDescriptionInUse}return RawObject.prototype.buildIndex=function(materialName,smoothingGroup){return materialName+"|"+smoothingGroup},RawObject.prototype.newInstanceFromObject=function(objectName,groupName){var newRawObject=new RawObject(objectName,groupName,this.mtllibName);return newRawObject.globalVertexOffset=this.globalVertexOffset+this.vertices.length/3,newRawObject.globalUvOffset=this.globalUvOffset+this.uvs.length/2,newRawObject.globalNormalOffset=this.globalNormalOffset+this.normals.length/3,newRawObject},RawObject.prototype.newInstanceFromGroup=function(groupName){var newRawObject=new RawObject(this.objectName,groupName,this.mtllibName);return newRawObject.vertices=this.vertices,newRawObject.uvs=this.uvs,newRawObject.normals=this.normals,newRawObject.globalVertexOffset=this.globalVertexOffset,newRawObject.globalUvOffset=this.globalUvOffset,newRawObject.globalNormalOffset=this.globalNormalOffset,newRawObject},RawObject.prototype.pushVertex=function(buffer){this.vertices.push(parseFloat(buffer[1])),this.vertices.push(parseFloat(buffer[2])),this.vertices.push(parseFloat(buffer[3]))},RawObject.prototype.pushUv=function(buffer){this.uvs.push(parseFloat(buffer[1])),this.uvs.push(parseFloat(buffer[2]))},RawObject.prototype.pushNormal=function(buffer){this.normals.push(parseFloat(buffer[1])),this.normals.push(parseFloat(buffer[2])),this.normals.push(parseFloat(buffer[3]))},RawObject.prototype.pushObject=function(objectName){this.objectName=objectName},RawObject.prototype.pushMtllib=function(mtllibName){this.mtllibName=mtllibName},RawObject.prototype.pushGroup=function(groupName){this.groupName=groupName,this.verifyIndex()},RawObject.prototype.pushUsemtl=function(mtlName){this.activeMtlName!==mtlName&&Validator.isValid(mtlName)&&(this.activeMtlName=mtlName,this.mtlCount++,this.verifyIndex())},RawObject.prototype.pushSmoothingGroup=function(activeSmoothingGroup){var normalized="off"===activeSmoothingGroup?0:activeSmoothingGroup;this.activeSmoothingGroup!==normalized&&(this.activeSmoothingGroup=normalized,this.smoothingGroupCount++,this.verifyIndex())},RawObject.prototype.verifyIndex=function(){var index=this.buildIndex(this.activeMtlName,0===this.activeSmoothingGroup?0:1);this.rawObjectDescriptionInUse=this.rawObjectDescriptions[index],Validator.isValid(this.rawObjectDescriptionInUse)||(this.rawObjectDescriptionInUse=new RawObjectDescription(this.objectName,this.groupName,this.activeMtlName,this.activeSmoothingGroup),this.rawObjectDescriptions[index]=this.rawObjectDescriptionInUse)},RawObject.prototype.buildQuadVVtVn=function(indexArray){for(var i=0;i<6;i++)this.attachFaceV_(indexArray[Consts.QUAD_INDICES_3[i]]),this.attachFaceVt(indexArray[Consts.QUAD_INDICES_3[i]+1]),this.attachFaceVn(indexArray[Consts.QUAD_INDICES_3[i]+2])},RawObject.prototype.buildQuadVVt=function(indexArray){for(var i=0;i<6;i++)this.attachFaceV_(indexArray[Consts.QUAD_INDICES_2[i]]),this.attachFaceVt(indexArray[Consts.QUAD_INDICES_2[i]+1])},RawObject.prototype.buildQuadVVn=function(indexArray){for(var i=0;i<6;i++)this.attachFaceV_(indexArray[Consts.QUAD_INDICES_2[i]]),this.attachFaceVn(indexArray[Consts.QUAD_INDICES_2[i]+1])},RawObject.prototype.buildQuadV=function(indexArray){for(var i=0;i<6;i++)this.attachFaceV_(indexArray[Consts.QUAD_INDICES_1[i]])},RawObject.prototype.buildFaceVVtVn=function(indexArray){for(var i=1;i<10;i+=3)this.attachFaceV_(indexArray[i]),this.attachFaceVt(indexArray[i+1]),this.attachFaceVn(indexArray[i+2])},RawObject.prototype.buildFaceVVt=function(indexArray){for(var i=1;i<7;i+=2)this.attachFaceV_(indexArray[i]),this.attachFaceVt(indexArray[i+1])},RawObject.prototype.buildFaceVVn=function(indexArray){for(var i=1;i<7;i+=2)this.attachFaceV_(indexArray[i]),this.attachFaceVn(indexArray[i+1])},RawObject.prototype.buildFaceV=function(indexArray){for(var i=1;i<4;i++)this.attachFaceV_(indexArray[i])},RawObject.prototype.attachFaceV_=function(faceIndex){var faceIndexInt=parseInt(faceIndex),index=3*(faceIndexInt-this.globalVertexOffset),rodiu=this.rawObjectDescriptionInUse;rodiu.vertices.push(this.vertices[index++]),rodiu.vertices.push(this.vertices[index++]),rodiu.vertices.push(this.vertices[index])},RawObject.prototype.attachFaceVt=function(faceIndex){var faceIndexInt=parseInt(faceIndex),index=2*(faceIndexInt-this.globalUvOffset),rodiu=this.rawObjectDescriptionInUse;rodiu.uvs.push(this.uvs[index++]),rodiu.uvs.push(this.uvs[index])},RawObject.prototype.attachFaceVn=function(faceIndex){var faceIndexInt=parseInt(faceIndex),index=3*(faceIndexInt-this.globalNormalOffset),rodiu=this.rawObjectDescriptionInUse;rodiu.normals.push(this.normals[index++]),rodiu.normals.push(this.normals[index++]),rodiu.normals.push(this.normals[index])},RawObject.prototype.buildLineVvt=function(lineArray){for(var length=lineArray.length,i=1;i<length;i++)this.vertices.push(parseInt(lineArray[i])),this.uvs.push(parseInt(lineArray[i]))},RawObject.prototype.buildLineV=function(lineArray){for(var length=lineArray.length,i=1;i<length;i++)this.vertices.push(parseInt(lineArray[i]))},RawObject.prototype.finalize=function(meshCreator,inputObjectCount,debug){var temp=this.rawObjectDescriptions;this.rawObjectDescriptions=[];var rawObjectDescription,index=0,absoluteVertexCount=0,absoluteNormalCount=0,absoluteUvCount=0;for(var name in temp)rawObjectDescription=temp[name],rawObjectDescription.vertices.length>0&&(this.rawObjectDescriptions[index++]=rawObjectDescription,absoluteVertexCount+=rawObjectDescription.vertices.length,absoluteUvCount+=rawObjectDescription.uvs.length,absoluteNormalCount+=rawObjectDescription.normals.length);var notEmpty=!1;return index>0&&(debug&&this.createReport(inputObjectCount,!0),meshCreator.buildMesh(this.rawObjectDescriptions,inputObjectCount,absoluteVertexCount,absoluteNormalCount,absoluteUvCount),notEmpty=!0),notEmpty},RawObject.prototype.createReport=function(inputObjectCount,printDirectly){var report={name:this.objectName?this.objectName:"groups",mtllibName:this.mtllibName,vertexCount:this.vertices.length/3,normalCount:this.normals.length/3,uvCount:this.uvs.length/2,smoothingGroupCount:this.smoothingGroupCount,mtlCount:this.mtlCount,rawObjectDescriptions:this.rawObjectDescriptions.length};return printDirectly&&(console.log("Input Object number: "+inputObjectCount+" Object name: "+report.name),console.log("Mtllib name: "+report.mtllibName),console.log("Vertex count: "+report.vertexCount),console.log("Normal count: "+report.normalCount),console.log("UV count: "+report.uvCount),console.log("SmoothingGroup count: "+report.smoothingGroupCount),console.log("Material count: "+report.mtlCount),console.log("Real RawObjectDescription count: "+report.rawObjectDescriptions),console.log("")),report},RawObject}(),RawObjectDescription=function(){function RawObjectDescription(objectName,groupName,materialName,smoothingGroup){this.objectName=objectName,this.groupName=groupName,this.materialName=materialName,this.smoothingGroup=smoothingGroup,this.vertices=[],this.uvs=[],this.normals=[]}return RawObjectDescription}(),MeshCreator=function(){function MeshCreator(){this.sceneGraphBaseNode=null,this.materials=null,this.debug=!1,this.globalObjectCount=1,this.validated=!1}return MeshCreator.prototype.setSceneGraphBaseNode=function(sceneGraphBaseNode){this.sceneGraphBaseNode=Validator.verifyInput(sceneGraphBaseNode,this.sceneGraphBaseNode),this.sceneGraphBaseNode=Validator.verifyInput(this.sceneGraphBaseNode,new THREE.Group)},MeshCreator.prototype.setMaterials=function(materials){this.materials=Validator.verifyInput(materials,this.materials),this.materials=Validator.verifyInput(this.materials,{materials:[]})},MeshCreator.prototype.setDebug=function(debug){!0!==debug&&!1!==debug||(this.debug=debug)},MeshCreator.prototype.validate=function(){this.validated||(this.setSceneGraphBaseNode(null),this.setMaterials(null),this.setDebug(null),this.globalObjectCount=1)},MeshCreator.prototype.finalize=function(){this.sceneGraphBaseNode=null,this.materials=null,this.validated=!1},MeshCreator.prototype.buildMesh=function(rawObjectDescriptions,inputObjectCount,absoluteVertexCount,absoluteNormalCount,absoluteUvCount){this.debug&&console.log("MeshCreator.buildRawMeshData:\nInput object no.: "+inputObjectCount);var bufferGeometry=new THREE.BufferGeometry,vertexBA=new THREE.BufferAttribute(new Float32Array(absoluteVertexCount),3);bufferGeometry.addAttribute("position",vertexBA);var normalBA;absoluteNormalCount>0&&(normalBA=new THREE.BufferAttribute(new Float32Array(absoluteNormalCount),3),bufferGeometry.addAttribute("normal",normalBA));var uvBA;absoluteUvCount>0&&(uvBA=new THREE.BufferAttribute(new Float32Array(absoluteUvCount),2),bufferGeometry.addAttribute("uv",uvBA));var rawObjectDescription,material,materialName,selectedMaterialIndex,vertexLength,createMultiMaterial=rawObjectDescriptions.length>1,materials=[],materialIndex=0,materialIndexMapping=[],vertexBAOffset=0,vertexGroupOffset=0,normalOffset=0,uvOffset=0;this.debug&&console.log(createMultiMaterial?"Creating Multi-Material":"Creating Material for object no.: "+this.globalObjectCount);for(var oodIndex in rawObjectDescriptions){if(rawObjectDescription=rawObjectDescriptions[oodIndex],materialName=rawObjectDescription.materialName,material=this.materials[materialName],material||(material=this.materials.defaultMaterial,material||(material=new THREE.MeshStandardMaterial({color:14479871}),material.name="defaultMaterial",this.materials.defaultMaterial=material),console.warn('object_group "'+rawObjectDescription.objectName+"_"+rawObjectDescription.groupName+'" was defined without material! Assigning "defaultMaterial".')),0===rawObjectDescription.smoothingGroup){materialName=material.name+"_flat";var materialClone=this.materials[materialName];materialClone||(materialClone=material.clone(),materialClone.name=materialName,materialClone.shading=THREE.FlatShading,this.materials[materialName]=name)}vertexLength=rawObjectDescription.vertices.length,createMultiMaterial&&(selectedMaterialIndex=materialIndexMapping[materialName],selectedMaterialIndex||(selectedMaterialIndex=materialIndex,materialIndexMapping[materialName]=materialIndex,materials.push(material),materialIndex++),bufferGeometry.addGroup(vertexGroupOffset,vertexLength/3,selectedMaterialIndex),vertexGroupOffset+=vertexLength/3),vertexBA.set(rawObjectDescription.vertices,vertexBAOffset),vertexBAOffset+=vertexLength,normalBA&&(normalBA.set(rawObjectDescription.normals,normalOffset),normalOffset+=rawObjectDescription.normals.length),uvBA&&(uvBA.set(rawObjectDescription.uvs,uvOffset),uvOffset+=rawObjectDescription.uvs.length),this.debug&&this.printReport(rawObjectDescription,selectedMaterialIndex)}normalBA||bufferGeometry.computeVertexNormals(),createMultiMaterial&&(material=materials);var mesh=new THREE.Mesh(bufferGeometry,material);mesh.name=""!==rawObjectDescription.groupName?rawObjectDescription.groupName:rawObjectDescription.objectName,this.sceneGraphBaseNode.add(mesh),this.globalObjectCount++},MeshCreator.prototype.printReport=function(rawObjectDescription,selectedMaterialIndex){var materialIndexLine=Validator.isValid(selectedMaterialIndex)?"\n materialIndex: "+selectedMaterialIndex:"";console.log(" Output Object no.: "+this.globalObjectCount+"\n objectName: "+rawObjectDescription.objectName+"\n groupName: "+rawObjectDescription.groupName+"\n materialName: "+rawObjectDescription.materialName+materialIndexLine+"\n smoothingGroup: "+rawObjectDescription.smoothingGroup+"\n #vertices: "+rawObjectDescription.vertices.length/3+"\n #uvs: "+rawObjectDescription.uvs.length/2+"\n #normals: "+rawObjectDescription.normals.length/3)},MeshCreator}();return OBJLoader2.prototype._buildWebWorkerCode=function(funcBuildObject,funcBuildSingelton){var workerCode="";return workerCode+=funcBuildObject("Consts",Consts),workerCode+=funcBuildObject("Validator",Validator),workerCode+=funcBuildSingelton("Parser","Parser",Parser),workerCode+=funcBuildSingelton("RawObject","RawObject",RawObject),workerCode+=funcBuildSingelton("RawObjectDescription","RawObjectDescription",RawObjectDescription)},OBJLoader2}();